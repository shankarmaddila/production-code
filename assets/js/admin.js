(function(){var t,i,n,a,o,s,e,c,l,r,u,d,h,p,m,g;console.log("admins only"),p="http://specials.interface.com/api/publish/history",g="http://specials.interface.com/api/publish/qa",m="http://specials.interface.com/api/publish/prod",a=null,h={production:null,qa:null},l=[],i=$(".log"),n=$(".activity-overlay"),t=$(".controls button"),o=function(i,a){l.push({t:i,m:a}),r("fail"),n.removeClass("active"),t.attr("disabled",""),$(".product-errors").fadeIn()},s=function(t,i){l.push({t:t,m:i}),r("success"),n.removeClass("active"),location.reload()},r=function(t){i.empty(),_.each(l,function(n,a,o){return this.template=a===o.length?"<div class='entry "+t+"'><span class='t'>"+n.t+"</span><span class='m'>"+n.m+"</span></div>":"<div class='entry "+t+"'><span class='t'>"+n.t+"</span><span class='m'>"+n.m+"</span></div>",i.prepend(this.template)})},u=function(){console.log(this.thisStatus=h[a].latest_run.status),this.moment=(new Date).toLocaleTimeString(),"Success"===this.thisStatus?s(this.moment,this.thisStatus):"Running"===this.thisStatus||"Initializing"===this.thisStatus?(l.push({t:this.moment,m:this.thisStatus}),r(),_.delay(function(){return window.pingStatus(this.thisStatus)},1e3)):"Failed"===this.thisStatus||"Aborted"===this.thisStatus?o(this.moment,this.thisStatus):o(this.moment,this.thisStatus)},d=function(t){h.production=_.where(t,{name:"publish-prod"})[0],h.qa=_.where(t,{name:"publish-qa"})[0]},window.pingStatus=function(){$.getJSON(p).done(function(t){d(t),u()}).fail(function(t,i,a){var o;o=i+", "+a,console.log("Request Failed: "+o),n.removeClass("active")})},$(".trigger-qa").click(function(o){var s;return n.addClass("active"),i.addClass("active"),a=$(o.currentTarget).data("action"),t.attr("disabled","disabled"),$(".data-status").fadeIn(),$(".product-errors").fadeOut(),s=(new Date).toLocaleTimeString(),i.prepend("<div class='entry'><span class='t'>"+s+"</span><span class='m'>Starting Up...</span></div>"),$.ajax({url:g,type:"get",success:function(){window.pingStatus()},error:function(t){console.log("Error: "+t)}}),!1}),$(".trigger-production").click(function(){confirm("Publish data to the live site?")}),c="#source=qa",e="#source=production",window.location.hash===c?_.delay(function(){return $("#adminTabs .tab-title a[href=#panel_qa]").trigger("click")},300):window.location.hash===e?_.delay(function(){return $("#adminTabs .tab-title a[href=#panel_production]").trigger("click")},300):console.log("no init hash found"),$("#adminTabs").on("toggled",function(){return function(t,i){var n;n=i.context.hash,"#panel_qa"===n?window.location.hash!==c&&(console.log("load qa"),window.location=window.location.origin+window.location.pathname+c,location.reload()):"#panel_production"===n?window.location.hash!==e&&(console.log("load production"),window.location=window.location.origin+window.location.pathname+e,location.reload()):console.log("No action specified.")}}(this))}).call(this);
